{
  "info": {
    "_postman_id": "064d2e29-bd0c-4c0e-a929-6fad7adaa937",
    "name": "Carrefour API Tests - ServeRest",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "25564308"
  },
  "item": [
    {
      "name": "Users",
      "item": []
    },
    {
      "name": "Auth",
      "item": []
    },
    {
      "name": "01 - Users (POS)",
      "item": [
        {
          "name": "Users - Create",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const random = Math.floor(Math.random() * 1000000);\r",
                  "pm.environment.set(\"email\", `teste${random}@qa.com`);\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status 201 - Usuário criado\", () => {\r",
                  "  pm.response.to.have.status(201);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "\r",
                  "// guarda o email criado para usar no teste de duplicado\r",
                  "pm.environment.set(\"created_email\", json.email);\r",
                  "\r",
                  "// (opcional) também guarda o id, se você já usa depois\r",
                  "pm.environment.set(\"user_id\", json._id || json.id);\r",
                  "\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"nome\": \"Usuario Teste\",\r\n  \"email\": \"{{email}}\",\r\n  \"password\": \"{{password}}\",\r\n  \"administrador\": \"true\"\r\n}\r\n",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/usuarios",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Auth - Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status 200 - Login realizado\", () => {\r",
                  "  pm.response.to.have.status(200);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "\r",
                  "pm.test(\"Retorna token JWT\", () => {\r",
                  "  pm.expect(json).to.have.property(\"authorization\");\r",
                  "});\r",
                  "\r",
                  "// salva o token no environment\r",
                  "pm.environment.set(\"token\", json.authorization);\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"email\": \"{{email}}\",\r\n  \"password\": \"{{password}}\"\r\n}\r\n",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "login"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Users - Get All",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status 200 - Lista de usuários retornada\", () => {\r",
                  "    pm.response.to.have.status(200);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "\r",
                  "pm.test(\"Retorna objeto com lista de usuários\", () => {\r",
                  "    pm.expect(json).to.have.property(\"usuarios\");\r",
                  "    pm.expect(json.usuarios).to.be.an(\"array\");\r",
                  "});\r",
                  "\r",
                  "pm.test(\"Retorna quantidade de usuários\", () => {\r",
                  "    pm.expect(json).to.have.property(\"quantidade\");\r",
                  "    pm.expect(json.quantidade).to.be.a(\"number\");\r",
                  "});\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/usuarios",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Users - Get by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status 200\", () => {\r",
                  "  pm.response.to.have.status(200);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "\r",
                  "pm.test(\"ID correto\", () => {\r",
                  "  pm.expect(json._id).to.equal(pm.environment.get(\"user_id\"));\r",
                  "});\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/usuarios/{{user_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios",
                "{{user_id}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Users - Update",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status 200 - Usuário atualizado\", () => {\r",
                  "  pm.response.to.have.status(200);\r",
                  "});\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"nome\": \"Usuario Atualizado\",\r\n  \"email\": \"{{email}}\",\r\n  \"password\": \"{{password}}\",\r\n  \"administrador\": \"true\"\r\n}\r\n",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/usuarios/{{user_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios",
                "{{user_id}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Users - Delete",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status 200 - Usuário excluído\", () => {\r",
                  "  pm.response.to.have.status(200);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "\r",
                  "pm.test(\"Mensagem de sucesso\", () => {\r",
                  "  pm.expect(json).to.have.property(\"message\");\r",
                  "});\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/usuarios/{{user_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios",
                "{{user_id}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Users - Get (Apos Delete)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status 400/404 - Não encontrado\", () => {\r",
                  "  pm.expect([400,404]).to.include(pm.response.code);\r",
                  "});\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/usuarios/{{user_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios",
                "{{user_id}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Users – Update (UPSERT) – Cria usuário quando ID não existe",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Retorna 201 ao criar usuário via PUT com ID inexistente\", () => {\r",
                  "  pm.response.to.have.status(201);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "\r",
                  "pm.test(\"Retorna mensagem de cadastro realizado\", () => {\r",
                  "  pm.expect(json.message).to.include(\"Cadastro realizado\");\r",
                  "});\r",
                  "\r",
                  "pm.test(\"Retorna novo ID de usuário\", () => {\r",
                  "  pm.expect(json).to.have.property(\"_id\");\r",
                  "});\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"nome\": \"Teste Update Inexistente\",\r\n  \"email\": \"inexistente{{$timestamp}}@qa.com\",\r\n  \"password\": \"{{password}}\",\r\n  \"administrador\": \"true\"\r\n}\r\n",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/usuarios/{{invalid_user_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios",
                "{{invalid_user_id}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "02 - Users (NEG)",
      "item": [
        {
          "name": "Users - Create (NEG) - Email inválido",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status 400 - Payload inválido\", () => {\r",
                  "    pm.response.to.have.status(400);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "\r",
                  "pm.test(\"Retorna erro de validação no campo email\", () => {\r",
                  "  pm.expect(json).to.have.property('email');\r",
                  "});\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"nome\": \"Usuario Sem Email\",\r\n  \"password\": \"teste123\",\r\n  \"administrador\": \"true\"\r\n}\r\n",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/usuarios",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Users – Create (NEG) – Campo obrigatório ausente",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Retorna 400 - validação de campo obrigatório\", () => {\r",
                  "  pm.response.to.have.status(400);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "\r",
                  "pm.test(\"Retorna mensagem de validação\", () => {\r",
                  "  pm.expect(json).to.be.an(\"object\");\r",
                  "  // ServeRest costuma devolver algo como { \"email\": \"email é obrigatório\" }\r",
                  "  pm.expect(Object.keys(json).length).to.be.greaterThan(0);\r",
                  "});\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"nome\": \"Teste Sem Email\",\r\n  \"password\": \"teste123\",\r\n  \"administrador\": \"true\"\r\n}\r\n",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/usuarios",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Users – Get by ID (NEG) – ID com formato inválido (400)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status 400 - ID com formato inválido\", () => {\r",
                  "  pm.response.to.have.status(400);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "\r",
                  "pm.test(\"Retorna mensagem de validação/erro para ID inválido\", () => {\r",
                  "  pm.expect(json).to.be.an(\"object\");\r",
                  "  pm.expect(json).to.have.property(\"message\");\r",
                  "  pm.expect(String(json.message).toLowerCase()).to.include(\"usuário não encontrado\");\r",
                  "});\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/usuarios/{{non_existing_user_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios",
                "{{non_existing_user_id}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Users – Get by ID (NEG) – Usuário inexistente (404)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Retorna 404 (não encontrado) ou 400 (id inválido)\", () => {\r",
                  "  pm.expect([400, 404]).to.include(pm.response.code);\r",
                  "});\r",
                  "\r",
                  "pm.test(\"Retorna JSON de erro\", () => {\r",
                  "  pm.response.to.be.json;\r",
                  "  const json = pm.response.json();\r",
                  "  pm.expect(json).to.be.an(\"object\");\r",
                  "  pm.expect(Object.keys(json).length).to.be.greaterThan(0);\r",
                  "});\r",
                  "\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/usuarios/{{invalid_user_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios",
                "{{invalid_user_id}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Users – Update (NEG) – Dados inválidos (400)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Retorna 400 - validação ao atualizar usuário\", () => {\r",
                  "  pm.response.to.have.status(400);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "\r",
                  "pm.test(\"Retorna mensagem de validação\", () => {\r",
                  "  pm.expect(json).to.be.an(\"object\");\r",
                  "  pm.expect(Object.keys(json).length).to.be.greaterThan(0);\r",
                  "});\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"nome\": \"Usuario Teste\",\r\n  \"email\": \"email_invalido\",\r\n  \"password\": \"teste123\",\r\n  \"administrador\": \"true\"\r\n}\r\n",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/usuarios/{{invalid_user_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios",
                "{{invalid_user_id}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Users – Delete (NEG) – Usuário inexistente (200)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status 200 - requisição processada\", () => {\r",
                  "  pm.response.to.have.status(200);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "\r",
                  "pm.test(\"Retorna mensagem informando que nenhum registro foi excluído\", () => {\r",
                  "  pm.expect(json).to.be.an(\"object\");\r",
                  "  pm.expect(json).to.have.property(\"message\");\r",
                  "  pm.expect(json.message.toLowerCase()).to.include(\"nenhum registro excluído\");\r",
                  "});\r",
                  "\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"nome\": \"Usuario Teste\",\r\n  \"email\": \"email_invalido\",\r\n  \"password\": \"teste123\",\r\n  \"administrador\": \"true\"\r\n}\r\n"
            },
            "url": {
              "raw": "{{base_url}}/usuarios/{{non_existing_user_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "usuarios",
                "{{non_existing_user_id}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "03 - Auth (NEG)",
      "item": [
        {
          "name": "Auth - Login (NEG) - Senha invalida",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Retorna 401 com credenciais inválidas\", () => {\r",
                  "  pm.response.to.have.status(401);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "pm.test(\"Retorna mensagem de autenticação inválida\", () => {\r",
                  "  pm.expect(json).to.have.property(\"message\");\r",
                  "});\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"email\": \"{{email}}\",\r\n  \"password\": \"senha_errada_123\"\r\n}\r\n",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "login"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Auth – Login (NEG) – Usuário não encontrado (400)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Retorna 400 - credenciais inválidas / usuário não encontrado\", () => {\r",
                  "  pm.response.to.have.status(401);\r",
                  "});\r",
                  "\r",
                  "const json = pm.response.json();\r",
                  "\r",
                  "pm.test(\"Retorna mensagem de erro\", () => {\r",
                  "  pm.expect(json).to.have.property(\"message\");\r",
                  "});\r",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"email\": \"naoexiste_123@qa.com\",\r\n  \"password\": \"{{password}}\"\r\n}\r\n"
            },
            "url": {
              "raw": "{{base_url}}/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "login"
              ]
            }
          },
          "response": []
        }
      ]
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{token}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "packages": {},
        "requests": {},
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "packages": {},
        "requests": {},
        "exec": [
          ""
        ]
      }
    }
  ]
}